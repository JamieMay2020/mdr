<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Launcher</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            display: flex;
            flex-direction: column;
        }

        /* Custom title bar */
        .title-bar {
            height: 32px;
            background: #151515;
            display: flex;
            align-items: center;
            padding: 0 15px;
            -webkit-app-region: drag; /* Make it draggable */
            border-bottom: 1px solid #222;
        }

        .title-bar-text {
            flex: 1;
            font-size: 13px;
            color: #888;
            font-weight: 500;
        }

        .title-bar button {
            -webkit-app-region: no-drag;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            margin-left: 8px;
            cursor: pointer;
        }

        .close-btn {
            background: #ff5f57;
        }

        .minimize-btn {
            background: #ffbd2e;
        }

        .close-btn:hover {
            background: #ff3b30;
        }

        .minimize-btn:hover {
            background: #ffaa00;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            height: calc(100vh - 32px);
            padding: 20px;
            overflow: hidden;
        }

        /* Left Side - Image/ASCII */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .image-section {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            height: 350px;
            display: flex;
            flex-direction: column;
        }

        .drop-zone {
            flex: 1;
            border: 2px dashed #444;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.2s;
            cursor: pointer;
            background: #0f0f0f;
        }

        .drop-zone.dragover {
            border-color: #00d4ff;
            background: #001a20;
        }

        .drop-zone.has-image {
            border-style: solid;
            border-color: #00d4ff;
        }

        .drop-content {
            text-align: center;
            color: #666;
        }

        .drop-zone img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
        }

        .drop-zone.has-image img {
            display: block;
        }

        .drop-zone.has-image .drop-content {
            display: none;
        }

        .ascii-preview {
            display: none;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            padding: 10px;
            white-space: pre;
            overflow: hidden;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            line-height: 1.2;
        }

        .drop-zone.has-ascii .ascii-preview {
            display: flex;
        }

        .drop-zone.has-ascii .drop-content {
            display: none;
        }

        .use-ascii-btn {
            margin-top: 10px;
            width: 100%;
            padding: 10px;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .use-ascii-btn:hover {
            background: #333;
            border-color: #666;
        }

        .use-ascii-btn:active {
            transform: scale(0.98);
        }

        /* Right Side - Form */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding-right: 10px;
            overflow-y: auto;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"] {
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            transition: all 0.2s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #00d4ff;
            background: #0f0f0f;
        }

        #tokenSymbol {
            text-transform: uppercase;
        }

        /* X/Twitter with Scan Button */
        .input-with-button {
            display: flex;
            gap: 10px;
        }

        .input-with-button input {
            flex: 1;
        }

        .scan-btn {
            padding: 0 20px;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .scan-btn:hover {
            background: #222;
            border-color: #00d4ff;
        }

        /* Buy Amount Buttons */
        .buy-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .buy-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .buy-btn {
            padding: 15px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .buy-btn:hover {
            background: #222;
            border-color: #666;
        }

        .buy-btn.selected {
            background: #00d4ff;
            border-color: #00d4ff;
            color: #000;
        }

        /* Priority Fee */
        .fee-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fee-input input {
            width: 120px;
        }

        .fee-input span {
            color: #666;
            font-size: 14px;
        }

        /* Create Button */
        .create-btn {
            padding: 18px;
            background: #00d4ff;
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
        }

        .create-btn:hover {
            background: #00a8cc;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }

        .create-btn:active {
            transform: translateY(0);
        }

        .create-btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Status */
        .status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #333;
            font-size: 14px;
            color: #888;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status.success {
            border-color: #00ff88;
            color: #00ff88;
        }

        .status.error {
            border-color: #ff3366;
            color: #ff3366;
        }

        .spinner {
            width: 14px;
            height: 14px;
            border: 2px solid #333;
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: none;
        }

        .status.loading .spinner {
            display: block;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hide file input */
        #fileInput {
            display: none;
        }
    </style>
</head>
<body>
    <div class="title-bar">
        <span class="title-bar-text">Token Launcher</span>
        <button class="minimize-btn" onclick="minimizeWindow()"></button>
        <button class="close-btn" onclick="closeWindow()"></button>
    </div>
    
    <div class="container">
        <div class="left-panel">
            <div class="image-section">
                <div class="drop-zone" id="dropZone">
                    <div class="drop-content">
                        <div style="font-size: 48px; margin-bottom: 10px;">ðŸ“Ž</div>
                        <div>Drag image from Discord</div>
                        <div style="font-size: 12px; color: #444; margin-top: 5px;">or click to browse</div>
                    </div>
                    <img id="preview" alt="Token image">
                    <div class="ascii-preview" id="asciiPreview"></div>
                </div>
                <input type="file" id="fileInput" accept="image/*">
                <button class="use-ascii-btn" id="useAsciiBtn">Use ASCII Image</button>
                <button class="use-ascii-btn" id="generateCoinBtn" style="margin-top: 5px;">Generate Coin Logo</button>
            </div>
        </div>

        <div class="right-panel">
            <div class="form-group">
                <label>Token Name</label>
                <input type="text" id="tokenName" placeholder="My Awesome Token" maxlength="32">
            </div>

            <div class="form-group">
                <label>Token Symbol</label>
                <input type="text" id="tokenSymbol" placeholder="BONK" maxlength="10">
            </div>

            <div class="form-group">
                <label>X/Twitter Link</label>
                <div class="input-with-button">
                    <input type="text" id="twitter" placeholder="https://x.com/yourtokenhandle">
                    <button class="scan-btn" onclick="scanClipboard()">Scan Clipboard</button>
                </div>
            </div>

            <div class="buy-section">
                <label>Initial Buy Amount (SOL)</label>
                <div class="buy-buttons">
                    <button class="buy-btn" data-amount="1" onclick="selectBuyAmount(1)">1 SOL</button>
                    <button class="buy-btn" data-amount="2" onclick="selectBuyAmount(2)">2 SOL</button>
                    <button class="buy-btn" data-amount="5" onclick="selectBuyAmount(5)">5 SOL</button>
                    <button class="buy-btn" data-amount="10" onclick="selectBuyAmount(10)">10 SOL</button>
                </div>
            </div>

            <div class="form-group">
                <label>Priority Fee</label>
                <div class="fee-input">
                    <input type="text" id="priorityFee" value="0.005">
                    <span>SOL</span>
                </div>
            </div>

            <button class="create-btn" id="createBtn" onclick="createToken()">Create Token</button>
        </div>
    </div>

    <div class="status" id="status">
        <div class="spinner"></div>
        <span id="statusText">Ready</span>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const figlet = require('figlet');
        
        let selectedImage = null;
        let uploadedImageUrl = null;
        let isUploading = false;
        let selectedBuyAmount = null;
        let useAscii = false;

        // Drop zone
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');

        dropZone.addEventListener('click', () => {
            if (!useAscii) fileInput.click();
        });
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', async (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            // Handle Discord image URLs
            const text = e.dataTransfer.getData('text/plain');
            if (text && (text.includes('http') || text.includes('https'))) {
                handleImageUrl(text);
                return;
            }
            
            // Handle file drops
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                handleImageFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageFile(e.target.files[0]);
            }
        });

        async function handleImageUrl(url) {
            updateStatus('Downloading image...', 'loading');
            useAscii = false;
            dropZone.classList.remove('has-ascii');
            
            try {
                // Download image through main process
                const result = await ipcRenderer.invoke('download-image', url);
                if (result.success) {
                    preview.src = result.dataUrl;
                    dropZone.classList.add('has-image');
                    uploadImageToIPFS(result.buffer);
                } else {
                    updateStatus('Failed to download image', 'error');
                }
            } catch (error) {
                updateStatus('Error downloading image', 'error');
            }
        }

        function handleImageFile(file) {
            useAscii = false;
            dropZone.classList.remove('has-ascii');
            selectedImage = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.src = e.target.result;
                dropZone.classList.add('has-image');
                uploadImageToIPFS(file);
            };
            reader.readAsDataURL(file);
        }

        async function uploadImageToIPFS(imageData) {
            isUploading = true;
            updateStatus('Uploading to IPFS...', 'loading');
            
            try {
                const formData = new FormData();
                if (imageData instanceof File) {
                    formData.append('image', imageData);
                } else {
                    formData.append('image', new Blob([imageData]), 'image.jpg');
                }
                
                const response = await fetch('https://nft-storage.letsbonk22.workers.dev/upload/img', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    uploadedImageUrl = await response.text();
                    updateStatus('Image uploaded', 'success');
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                updateStatus('IPFS upload failed', 'error');
            } finally {
                isUploading = false;
            }
        }

        // ASCII Art
        document.getElementById('useAsciiBtn').addEventListener('click', () => {
            const symbol = document.getElementById('tokenSymbol').value.trim().toUpperCase();
            if (!symbol) {
                alert('Enter token symbol first');
                return;
            }
            
            generateAsciiArt(symbol);
        });

        // Coin Logo Loading
        document.getElementById('generateCoinBtn').addEventListener('click', async () => {
            const symbol = document.getElementById('tokenSymbol').value.trim().toUpperCase();
            if (!symbol) {
                alert('Enter token symbol first');
                return;
            }
            
            updateStatus('Loading coin logo...', 'loading');
            
            try {
                const result = await ipcRenderer.invoke('load-coin-logo', symbol);
                
                if (result.success) {
                    // Display the loaded image
                    useAscii = false;
                    dropZone.classList.remove('has-ascii');
                    dropZone.classList.add('has-image');
                    
                    preview.src = result.dataUrl;
                    preview.style.display = 'block';
                    
                    // Create a File object from the buffer
                    const blob = new Blob([new Uint8Array(result.buffer)], { type: 'image/png' });
                    selectedImage = new File([blob], `${symbol[0]}.png`, { type: 'image/png' });
                    
                    // Upload to IPFS
                    uploadImageToIPFS(blob);
                } else {
                    updateStatus('Coin logo not found', 'error');
                }
            } catch (error) {
                updateStatus('Error loading coin logo', 'error');
            }
        });

        function generateAsciiArt(text) {
            useAscii = true;
            dropZone.classList.remove('has-image');
            dropZone.classList.add('has-ascii');
            
            // Generate ASCII art using figlet with slant font
            figlet.text(text, {
                font: 'Slant',
                horizontalLayout: 'default',
                verticalLayout: 'default',
                width: 80,
                whitespaceBreak: true
            }, function(err, asciiArt) {
                if (err) {
                    console.error('ASCII generation error:', err);
                    updateStatus('Failed to generate ASCII', 'error');
                    return;
                }
                
                document.getElementById('asciiPreview').textContent = asciiArt;
                // Convert to image and upload
                convertAsciiToImage(asciiArt);
            });
        }

        function generateSimpleAscii(text) {
            // Using slant font style ASCII art
            const slantPatterns = {
                'A': [
                    '    ___   ',
                    '   /   \\  ',
                    '  / /_\\ \\ ',
                    ' / _____ \\',
                    '/_/     \\_\\'
                ],
                'B': [
                    ' ____  ',
                    '| __ ) ',
                    '|  _ \\ ',
                    '| |_) |',
                    '|____/ '
                ],
                'C': [
                    '  ____ ',
                    ' / ___|',
                    '| |    ',
                    '| |___ ',
                    ' \\____|'
                ],
                'D': [
                    ' ____  ',
                    '|  _ \\ ',
                    '| | | |',
                    '| |_| |',
                    '|____/ '
                ],
                'E': [
                    ' _____ ',
                    '| ____|',
                    '|  _|  ',
                    '| |___ ',
                    '|_____|'
                ],
                'F': [
                    ' _____ ',
                    '|  ___|',
                    '| |_   ',
                    '|  _|  ',
                    '|_|    '
                ],
                'G': [
                    '  ____ ',
                    ' / ___|',
                    '| |  _ ',
                    '| |_| |',
                    ' \\____|'
                ],
                'H': [
                    ' _   _ ',
                    '| | | |',
                    '| |_| |',
                    '|  _  |',
                    '|_| |_|'
                ],
                'I': [
                    ' ___ ',
                    '|_ _|',
                    ' | | ',
                    ' | | ',
                    '|___|'
                ],
                'J': [
                    '     _ ',
                    '    | |',
                    ' _  | |',
                    '| |_| |',
                    ' \\___/ '
                ],
                'K': [
                    ' _  __',
                    '| |/ /',
                    "| ' / ",
                    '| . \\ ',
                    '|_|\\_\\'
                ],
                'L': [
                    ' _     ',
                    '| |    ',
                    '| |    ',
                    '| |___ ',
                    '|_____|'
                ],
                'M': [
                    ' __  __ ',
                    '|  \\/  |',
                    '| |\\/| |',
                    '| |  | |',
                    '|_|  |_|'
                ],
                'N': [
                    ' _   _ ',
                    '| \\ | |',
                    '|  \\| |',
                    '| |\\  |',
                    '|_| \\_|'
                ],
                'O': [
                    '  ___  ',
                    ' / _ \\ ',
                    '| | | |',
                    '| |_| |',
                    ' \\___/ '
                ],
                'P': [
                    ' ____  ',
                    '|  _ \\ ',
                    '| |_) |',
                    '|  __/ ',
                    '|_|    '
                ],
                'Q': [
                    '  ___  ',
                    ' / _ \\ ',
                    '| | | |',
                    '| |_| |',
                    ' \\__\\_\\'
                ],
                'R': [
                    ' ____  ',
                    '|  _ \\ ',
                    '| |_) |',
                    '|  _ < ',
                    '|_| \\_\\'
                ],
                'S': [
                    ' ____  ',
                    '/ ___| ',
                    '\\___ \\ ',
                    ' ___) |',
                    '|____/ '
                ],
                'T': [
                    ' _____ ',
                    '|_   _|',
                    '  | |  ',
                    '  | |  ',
                    '  |_|  '
                ],
                'U': [
                    ' _   _ ',
                    '| | | |',
                    '| | | |',
                    '| |_| |',
                    ' \\___/ '
                ],
                'V': [
                    '__     __',
                    '\\ \\   / /',
                    ' \\ \\ / / ',
                    '  \\ V /  ',
                    '   \\_/   '
                ],
                'W': [
                    '__        __',
                    '\\ \\      / /',
                    ' \\ \\ /\\ / / ',
                    '  \\ V  V /  ',
                    '   \\_/\\_/   '
                ],
                'X': [
                    '__  __',
                    '\\ \\/ /',
                    ' \\  / ',
                    ' /  \\ ',
                    '/_/\\_\\'
                ],
                'Y': [
                    '__   __',
                    '\\ \\ / /',
                    ' \\ V / ',
                    '  | |  ',
                    '  |_|  '
                ],
                'Z': [
                    ' _____',
                    '|__  /',
                    '  / / ',
                    ' / /_ ',
                    '/____|'
                ],
                '0': [
                    '  ___  ',
                    ' / _ \\ ',
                    '| | | |',
                    '| |_| |',
                    ' \\___/ '
                ],
                '1': [
                    ' _ ',
                    '/ |',
                    '| |',
                    '| |',
                    '|_|'
                ],
                '2': [
                    ' ____  ',
                    '|___ \\ ',
                    '  __) |',
                    ' / __/ ',
                    '|_____|'
                ],
                '3': [
                    ' _____ ',
                    '|___ / ',
                    '  |_ \\ ',
                    ' ___) |',
                    '|____/ '
                ],
                '4': [
                    ' _  _   ',
                    '| || |  ',
                    '| || |_ ',
                    '|__   _|',
                    '   |_|  '
                ],
                '5': [
                    ' ____  ',
                    '| ___| ',
                    '|___ \\ ',
                    ' ___) |',
                    '|____/ '
                ],
                '6': [
                    '  __   ',
                    ' / /_  ',
                    "| '_ \\ ",
                    '| (_) |',
                    ' \\___/ '
                ],
                '7': [
                    ' _____ ',
                    '|___  |',
                    '   / / ',
                    '  / /  ',
                    ' /_/   '
                ],
                '8': [
                    '  ___  ',
                    ' ( _ ) ',
                    ' / _ \\ ',
                    '| (_) |',
                    ' \\___/ '
                ],
                '9': [
                    '  ___  ',
                    ' / _ \\ ',
                    '| (_) |',
                    ' \\__, |',
                    '   /_/ '
                ]
            };
            
            const chars = text.toUpperCase().split('');
            let art = '\n';
            
            // Build ASCII art line by line
            for (let row = 0; row < 5; row++) {
                let line = '';
                for (let char of chars) {
                    if (slantPatterns[char]) {
                        line += slantPatterns[char][row];
                    } else {
                        line += '     '; // Space for unknown characters
                    }
                }
                art += line + '\n';
            }
            
            return art;
        }

        async function convertAsciiToImage(asciiText) {
            updateStatus('Converting ASCII to image...', 'loading');
            
            // Create canvas
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size to 400x400
            canvas.width = 400;
            canvas.height = 400;
            
            // Dark background
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // White/grey text
            ctx.fillStyle = '#e0e0e0';
            ctx.font = '16px "Courier New", monospace';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Draw ASCII art centered
            const lines = asciiText.split('\n');
            const lineHeight = 20;
            const totalHeight = lines.length * lineHeight;
            const startY = (canvas.height - totalHeight) / 2 + lineHeight/2;
            
            lines.forEach((line, i) => {
                ctx.fillText(line, canvas.width / 2, startY + (i * lineHeight));
            });
            
            // Store canvas reference for later use
            document.body.appendChild(canvas);
            canvas.style.display = 'none';
            
            // Convert to blob and upload
            canvas.toBlob(async (blob) => {
                // Store the blob for later use
                selectedImage = new File([blob], 'ascii.png', { type: 'image/png' });
                uploadImageToIPFS(blob);
            }, 'image/png');
        }

        // Buy amount selection
        function selectBuyAmount(amount) {
            selectedBuyAmount = amount;
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-amount="${amount}"]`).classList.add('selected');
        }

        // Scan clipboard
        async function scanClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                if (text && (text.includes('x.com') || text.includes('twitter.com'))) {
                    document.getElementById('twitter').value = text;
                    updateStatus('X link pasted from clipboard', 'success');
                } else {
                    updateStatus('No X/Twitter link found in clipboard', 'error');
                }
            } catch (error) {
                updateStatus('Cannot access clipboard', 'error');
            }
        }

        // Create token
        async function createToken() {
            const name = document.getElementById('tokenName').value.trim();
            const symbol = document.getElementById('tokenSymbol').value.trim().toUpperCase();
            
            if (!name || !symbol) {
                alert('Enter token name and symbol');
                return;
            }
            
            if (!selectedBuyAmount) {
                alert('Select initial buy amount');
                return;
            }
            
            if (!uploadedImageUrl && !isUploading) {
                alert('Add an image or use ASCII');
                return;
            }
            
            // Wait for upload if in progress
            if (isUploading) {
                updateStatus('Waiting for image upload...', 'loading');
                while (isUploading) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            }
            
            const createBtn = document.getElementById('createBtn');
            createBtn.disabled = true;
            updateStatus('Creating token...', 'loading');
            
            try {
                // Prepare image data
                let imageBuffer = null;
                if (selectedImage) {
                    // Convert File to buffer for original images
                    imageBuffer = await selectedImage.arrayBuffer();
                } else if (useAscii) {
                    // For ASCII/coin logos, get the canvas data
                    const canvas = document.querySelector('canvas');
                    if (canvas) {
                        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                        imageBuffer = await blob.arrayBuffer();
                    }
                }
                
                const tokenData = {
                    name,
                    symbol,
                    imageUrl: uploadedImageUrl,
                    imageBuffer: imageBuffer ? Array.from(new Uint8Array(imageBuffer)) : null, // Convert to array for IPC
                    twitter: document.getElementById('twitter').value.trim(),
                    initialBuy: selectedBuyAmount,
                    priorityFee: parseFloat(document.getElementById('priorityFee').value)
                };
                
                const result = await ipcRenderer.invoke('create-token', tokenData);
                
                if (result.success) {
                    updateStatus(`Token created! ${result.tokenAddress}`, 'success');
                    // Copy token address to clipboard
                    navigator.clipboard.writeText(result.tokenAddress);
                    // Reset form after 3 seconds
                    setTimeout(() => {
                        resetForm();
                    }, 3000);
                } else {
                    updateStatus('Token creation failed', 'error');
                }
            } catch (error) {
                updateStatus('Error creating token', 'error');
            } finally {
                createBtn.disabled = false;
            }
        }

        function resetForm() {
            document.getElementById('tokenName').value = '';
            document.getElementById('tokenSymbol').value = '';
            document.getElementById('twitter').value = '';
            selectedBuyAmount = null;
            document.querySelectorAll('.buy-btn').forEach(btn => btn.classList.remove('selected'));
            dropZone.classList.remove('has-image', 'has-ascii');
            uploadedImageUrl = null;
            useAscii = false;
            updateStatus('Ready');
        }

        function updateStatus(text, type = '') {
            const status = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            
            status.className = 'status';
            if (type) status.classList.add(type);
            statusText.textContent = text;
        }

        function generateCoinLogo(symbol) {
            useAscii = false;
            dropZone.classList.remove('has-ascii');
            dropZone.classList.add('has-image');
            
            updateStatus('Generating coin logo...', 'loading');
            
            // Create canvas
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set size
            canvas.width = 400;
            canvas.height = 400;
            
            // White background
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Green circle
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 160; // 80% of canvas
            
            ctx.fillStyle = '#4CAF50'; // Material green
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.fill();
            
            // Get first letter
            const letter = symbol.charAt(0);
            
            // Set up text
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 180px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Measure text to position vertical lines properly
            const metrics = ctx.measureText(letter);
            const textWidth = metrics.width;
            
            // Draw the letter
            ctx.fillText(letter, centerX, centerY);
            
            // Add vertical lines (Bitcoin style)
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 12;
            
            // Left vertical line
            const lineOffset = textWidth * 0.3;
            const lineHeight = 60;
            
            // Top part of left line
            ctx.beginPath();
            ctx.moveTo(centerX - lineOffset, centerY - 90);
            ctx.lineTo(centerX - lineOffset, centerY - 90 - lineHeight);
            ctx.stroke();
            
            // Bottom part of left line
            ctx.beginPath();
            ctx.moveTo(centerX - lineOffset, centerY + 90);
            ctx.lineTo(centerX - lineOffset, centerY + 90 + lineHeight);
            ctx.stroke();
            
            // Right vertical line
            // Top part of right line
            ctx.beginPath();
            ctx.moveTo(centerX + lineOffset, centerY - 90);
            ctx.lineTo(centerX + lineOffset, centerY - 90 - lineHeight);
            ctx.stroke();
            
            // Bottom part of right line
            ctx.beginPath();
            ctx.moveTo(centerX + lineOffset, centerY + 90);
            ctx.lineTo(centerX + lineOffset, centerY + 90 + lineHeight);
            ctx.stroke();
            
            // Convert to data URL for preview
            const dataUrl = canvas.toDataURL('image/png');
            preview.src = dataUrl;
            preview.style.display = 'block';
            
            // Convert to blob and upload
            canvas.toBlob(async (blob) => {
                uploadImageToIPFS(blob);
            }, 'image/png');
        }

        // Window controls
        function minimizeWindow() {
            ipcRenderer.send('minimize-window');
        }

        function closeWindow() {
            ipcRenderer.send('close-window');
        }

        // Auto uppercase symbol
        document.getElementById('tokenSymbol').addEventListener('input', (e) => {
            e.target.value = e.target.value.toUpperCase();
        });
    </script>
</body>
</html>